#!/bin/bash
set -x

bundle install

command=${1:-$CONTAINER_ROLE}
case $command in
  console)
    bundle exec rails console
    ;;
  server)
    exec bundle exec rails server -b 0.0.0.0 "${@:2}"
    ;;
  sidekiq)
    exec bundle exec sidekiq "${@:2}"
    ;;
  init)
    bundle exec rails db:migrate
    bundle exec rails hyrax:default_admin_set:create hyrax:default_collection_types:create
    ;;
  sh)
    sh "${@:2}"
    ;;
  migrate)
    if bundle exec rails db:migrate:status &> /dev/null; then
      bundle exec rails db:migrate
    fi
    ;;
  *)
    echo "Command unknown: $command"
    exit 1
esac
